const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}};p();function v(){const o=document.getElementById("imageProcessed"),t=o.getContext("2d"),r={past:[],present:null,future:[],add(e){this.present!==e&&(this.present&&this.past.push(this.present),this.present=e,this.future=[])},undo(){if(this.past.length===0)return;const e=this.past[this.past.length-1],n=this.past.slice(0,this.past.length-1),s=this.present;this.past=n,this.present=e,this.future=[s,...this.future]},redo(){if(this.future.length===0)return;const e=this.future[0],n=this.future.slice(1);this.past.push(this.present),this.present=e,this.future=n}};return{isEmpty(){return r.present===null},getPosition(){const e=o.getBoundingClientRect();return{top:e.top+window.pageYOffset-document.documentElement.clientTop,left:e.left+window.pageXOffset-document.documentElement.clientLeft}},getSize(){return{width:o.width,height:o.height}},resize(e){o.width=e.width,o.height=e.height},draw(e){e(t),this.commitDraw()},drawWithoutCommit(e){e(t)},commitDraw(){const e=this.getSize(),n=t.getImageData(0,0,e.width,e.height);r.add(new ImageData(new Uint8ClampedArray(n.data),n.width,n.height))},drawImage(e){const{width:n,height:s}=e;this.resize({width:n,height:s}),this.draw(a=>{a.drawImage(e,0,0,n,s)})},performWhileMouseDown(e){let n=!1;const{onmousedown:s,onmousemove:a,onmouseup:m}=e();o.onmousedown=d=>{n=!0,s==null||s(d)},o.onmousemove=d=>{!n||a==null||a(d)},o.onmouseup=d=>{n=!1,m==null||m(d),this.commitDraw()}},applyPixelTransformation(e){this.draw(n=>{const{width:s,height:a}=this.getSize(),m=n.getImageData(0,0,s,a);e(m.data),n.putImageData(m,0,0)})},undo(){r.undo();const{width:e,height:n}=r.present;this.resize({width:e,height:n}),t.putImageData(r.present,0,0)},redo(){r.redo();const{width:e,height:n}=r.present;this.resize({width:e,height:n}),t.putImageData(r.present,0,0)},getOctetStream(){return o.toDataURL("image/png").replace("image/png","image/octet-stream")}}}const i=v();document.getElementById("dragAndDropZone").addEventListener("dragover",o=>{o.preventDefault()});document.getElementById("dragAndDropZone").addEventListener("drop",o=>{o.preventDefault();function t(n){const s=new Image;s.src=n,s.onload=()=>{document.querySelector(".drag-helper").classList.add("invisible"),document.getElementById("controls").classList.remove("no-events"),i.drawImage(s)}}const r=o.dataTransfer.files[0];if(r){const n=new FileReader;n.readAsDataURL(r),n.onload=s=>{t(s.target.result)}}const e=o.dataTransfer.getData("url");e&&t(e)});document.getElementById("ellipseDraw").addEventListener("click",()=>{i.performWhileMouseDown(()=>{const o=new Image;let t,r,e;return{onmousedown:({pageX:a,pageY:m})=>{e=i.getPosition(),t=a-e.left,r=m-e.top,o.src=i.getOctetStream()},onmousemove:({pageX:a,pageY:m})=>{i.drawWithoutCommit(d=>{const{width:u,height:c}=i.getSize();d.drawImage(o,0,0,u,c);const l=a-e.left,h=m-e.top;d.beginPath(),d.moveTo(t,r+(h-r)/2),d.bezierCurveTo(t,r,l,r,l,r+(h-r)/2),d.bezierCurveTo(l,h,t,h,t,r+(h-r)/2),d.closePath(),d.stroke()})}}})});document.getElementById("rectangleDraw").addEventListener("click",()=>{i.performWhileMouseDown(()=>{const o=new Image;let t,r,e;return{onmousedown:({pageX:a,pageY:m})=>{e=i.getPosition(),t=a-e.left,r=m-e.top,o.src=i.getOctetStream()},onmousemove:({pageX:a,pageY:m})=>{const d=a-e.left,u=m-e.top,c=d-t,l=u-r;i.drawWithoutCommit(h=>{const g=i.getSize();h.drawImage(o,0,0,g.width,g.height),!(!c||!l)&&h.strokeRect(t,r,c,l)})}}})});document.getElementById("penDraw").addEventListener("click",()=>{i.performWhileMouseDown(()=>({onmousedown:({offsetX:r,offsetY:e})=>{i.drawWithoutCommit(n=>{n.beginPath(),n.moveTo(r,e)})},onmousemove:r=>{i.drawWithoutCommit(e=>{e.lineTo(r.offsetX,r.offsetY),e.stroke()})}}))});document.getElementById("lineDraw").addEventListener("click",()=>{i.performWhileMouseDown(()=>{const o=new Image;let t,r,e;return{onmousedown:({pageX:a,pageY:m})=>{e=i.getPosition(),t=a-e.left,r=m-e.top,o.src=i.getOctetStream()},onmousemove:({pageX:a,pageY:m})=>{i.drawWithoutCommit(d=>{const u=i.getSize();d.drawImage(o,0,0,u.width,u.height),d.beginPath(),d.moveTo(t,r),d.lineTo(a-e.left,m-e.top),d.stroke(),d.closePath()})}}})});document.getElementById("cropButton").addEventListener("click",()=>{i.performWhileMouseDown(()=>{const o=new Image;let t,r,e,n,s;return{onmousedown:({pageX:u,pageY:c})=>{e=i.getPosition(),t=u-e.left,r=c-e.top,o.src=i.getOctetStream()},onmousemove:({pageX:u,pageY:c})=>{const l=u-e.left,h=c-e.top;n=l-t,s=h-r,i.drawWithoutCommit(g=>{const w=i.getSize();g.drawImage(o,0,0,w.width,w.height),!(!n||!s)&&g.strokeRect(t,r,n,s)})},onmouseup:()=>{i.drawWithoutCommit(u=>{const c=Math.abs(n),l=Math.abs(s);i.resize({width:c,height:l}),u.drawImage(o,t,r,n,s,0,0,c,l)})}}})});const y=new bootstrap.Modal(document.getElementById("resolutionModal"));document.getElementById("resolutionModal").addEventListener("show.bs.modal",()=>{const o=new Image,t=document.getElementById("width-size"),r=document.getElementById("height-size"),e=document.getElementById("checkbox-img-ratio"),n=i.getSize();t.value=n.width,r.value=n.height;const s=n.width/n.height;t.addEventListener("keyup",()=>{!e.checked||(r.value=t.value/s)}),r.addEventListener("keyup",()=>{!e.checked||(t.value=r.value*s)}),document.getElementById("saveResolution").addEventListener("click",()=>{o.src=i.getOctetStream(),o.width=t.value,o.height=r.value,o.onload=()=>i.drawImage(o),y.hide()})});document.getElementById("grayscale").addEventListener("click",()=>{i.applyPixelTransformation(o=>{for(let t=0;t<o.length;t+=4)o[t]=o[t+1]=o[t+2]=Math.round((o[t]+o[t+1]+o[t+2])/3)})});document.getElementById("threshold").addEventListener("click",()=>{i.applyPixelTransformation(o=>{for(let t=0;t<o.length;t+=4){const[r,e,n]=f(o,t),s=.2126*r+.7152*e+.0722*n>=180?255:0;o[t]=o[t+1]=o[t+2]=s}})});document.getElementById("sephia").addEventListener("click",()=>{i.applyPixelTransformation(o=>{for(let t=0;t<o.length;t+=4){const[r,e,n]=f(o,t);o[t]=r*.393+e*.769+n*.189,o[t+1]=r*.349+e*.686+n*.168,o[t+2]=r*.272+e*.534+n*.131}})});document.getElementById("invert").addEventListener("click",()=>{i.applyPixelTransformation(o=>{for(let t=0;t<o.length;t+=4){const[r,e,n]=f(o,t);o[t]=255-r,o[t+1]=255-e,o[t+2]=255-n}})});function f(o,t){return[o[t],o[t+1],o[t+2]]}document.getElementById("redoButton").addEventListener("click",()=>i.redo());document.getElementById("undoButton").addEventListener("click",()=>i.undo());document.getElementById("linkDownload").addEventListener("click",o=>{i.isEmpty()&&o.preventDefault(),o.currentTarget.setAttribute("href",i.getOctetStream())});
